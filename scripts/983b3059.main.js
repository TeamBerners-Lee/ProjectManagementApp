"use strict";var trace=function(){for(var a=0;a<arguments.length;a++)console.log(arguments[a])},App=App||{url:"https://project-management-api.herokuapp.com"},NewProject=NewProject||{},Router=Backbone.Router.extend({routes:{home:"home",users:"users","users/:id":"user",projects:"projects","projects/:id":"project","new-project":"newProject",tasks:"tasks","tasks/:id":"task"},home:function(){$("#container").empty()},users:function(){trace("hello from the users backbone!"),$("#container").empty(),$(".jumbotron").hide(),$.ajax({url:App.url+"/users",type:"GET"}).done(function(a){var b=Handlebars.compile($("#usersTemplate").html());$("#container").html(b({users:a.users}))}).fail(function(a,b,c){trace(a,b,c)}).always(function(a){trace(a)})},user:function(a){trace("hello from the user backbone!",a),$("#container").empty(),$(".jumbotron").hide();var b=window.location.hash,c=b.lastIndexOf("/"),d=parseInt(b.substring(c+1,b.length));$.ajax({url:App.url+"/users/"+d,type:"GET"}).done(function(a){var b=Handlebars.compile($("#userTemplate").html());$("#container").html(b({user:a.user})),$("button#avatar-change").click(function(){console.log("i am clicking on the button"),$("div#sign-in-form-slide").is(":hidden")?($("div#avatar-form").slideDown("slow"),App.getAmazonKey()):$("div#sign-in-form-slide").hide()})}).fail(function(a,b,c){trace(a,b,c)}).always(function(a){trace(a)})},projects:function(){trace("hello from the projects backbone!"),$("#container").empty(),$(".jumbotron").hide(),$.ajax({url:App.url+"/projects",type:"GET"}).done(function(a){var b=Handlebars.compile($("#projectsTemplate").html());$("#container").html(b({projects:a.projects}))}).fail(function(a,b,c){trace(a,b,c)}).always(function(a){trace(a)})},project:function(){trace("hello from the project backbone!"),$("#container").empty(),$(".jumbotron").hide();var a=window.location.hash,b=a.lastIndexOf("/"),c=parseInt(a.substring(b+1,a.length));$.ajax({url:App.url+"/projects/"+c,type:"GET"}).done(function(a){var b=Handlebars.compile($("#projectTemplate").html());$("#container").html(b({project:a.project}))}).fail(function(a,b,c){trace(a,b,c)}).always(function(a){trace(a)})},newProject:function(){trace("hello from the new submissions view"),$("#container").empty().load("partials/project-form.html",function(){var a=$("#new-project-form");a.on("submit",function(b){NewProject.processForm(b,a,router)})})},task:function(){trace("hello from the task backbone!"),$("#container").empty(),$(".jumbotron").hide();var a=window.location.hash,b=a.lastIndexOf("/"),c=parseInt(a.substring(b+1,a.length));$.ajax({url:App.url+"/tasks/"+c,type:"GET"}).done(function(a){var b=Handlebars.compile($("#taskTemplate").html());$("#container").html(b({task:a.task}))}).fail(function(a,b,c){trace(a,b,c)}).always(function(a){trace(a)})}});NewProject.processForm=function(a,b,c){a.preventDefault&&a.preventDefault();var d=$(b).find("input[name='proj-name']").val(),e=$(b).find("input[name='proj-description']").val(),f=$(b).find("input[name='proj-date']").val(),g=$(b).find("select[name='proj-privacy']").val();NewProject.postParams(d,e,f,g,c)},NewProject.postParams=function(a,b,c,d,e){$.ajax({url:App.url+"/projects",type:"POST",data:{project:{name:a,description:b,due_date:c,privacy:d}},complete:function(a,b){trace(a,b,"complete post!!")},success:function(a,b,c){e.navigate("projects",{trigger:!0}),trace(a,b,c,"successful post!!")},error:function(a,b,c){trace(a,b,c)}}).done(function(a){trace(a,"posted project!!")}).fail(function(a,b,c){trace(a,b,c),e.navigate("projects",{trigger:!0}),trace("wat")}).always(function(a){trace(a)})};var router=new Router;Backbone.history.start(),$(document).ready(function(){trace("'allo from the main js!"),$("div#avatar-change").hide(),$("#userlink").on("click",function(){})});var authToken,UserApp=function(){var a,b=function(){authToken=localStorage.getItem("authToken"),a="https://project-management-api.herokuapp.com",f(),$("#sign-in-form").on("submit",e),$("#sign-up-form").on("submit",c),$("#signout").on("click",g)},c=function(b){return b.preventDefault(),$.ajax({url:a+"/users",type:"POST",data:{user:{username:$("#username").val(),title:$("#title").val(),email:$("#email").val(),password:$("#password").val()}}}).done(function(a){d(a),console.log(a)}).fail(function(a){console.log(a)}),!1},d=function(a){localStorage.setItem("authToken",a.token),localStorage.setItem("currentUser",a.id),$.ajax({url:App.url+"/users/"+a.id,type:"GET"}).done(function(a){var b=Handlebars.compile($("#userTemplate").html());$("#container").html(b({user:a})),$("button#avatar-change").click(function(){console.log("i am clicking on the button"),$("div#sign-in-form-slide").is(":hidden")?($("div#avatar-form").slideDown("slow"),App.getAmazonKey()):$("div#sign-in-form-slide").hide()})}).fail(function(a,b,c){trace(a,b,c)}).always(function(a){trace(a)}),window.location.href="/#/users/"+a.id},e=function(b){var c;return b.preventDefault(),c=$(this),$.ajax({url:a+"/users/sign_in",type:"POST",data:c.serialize()}).done(d).fail(function(a){console.log(a)}),!1},f=function(){$.ajaxPrefilter(function(a){a.headers={},a.headers.AUTHORIZATION="Token token="+localStorage.authToken})},g=function(a){a.preventDefault(),localStorage.removeItem("authToken"),authToken=void 0,console.log("User has been signed out"),location.reload(),window.location.href="/"};return{run:b}}(),SignUp=function(){$("button#sign-up").click(function(){$("div#form-slide").is(":hidden")?$("div#form-slide").slideDown("slow"):$("div#form-slide").hide()})},SignIn=function(){$("button#sign-in").click(function(){$("div#sign-in-form-slide").is(":hidden")?$("div#sign-in-form-slide").slideDown("slow"):$("div#sign-in-form-slide").hide()})};$(document).ready(function(){console.log("allo from the sign in js!"),UserApp.run(),$("div#form-slide").hide(),$("div#sign-in-form-slide").hide(),SignUp(),SignIn()});var myAws,fileName;App.getAmazonKey=function(){console.log("im in the getamazonkey function");var a="https://project-management-api.herokuapp.com";$.ajax({url:a+"/amazon/sign_key/image%2Fjpeg"}).done(function(a){myAws=a,App.buildFormData(a),App.sendImageToRails(a.key)})},App.buildFormData=function(a){console.log("im in the buildformdata function"),fileName=a.key,console.log("I'm in the build form data section "+a.key),$("form#avatar").append('<input type="hidden" name="key" value="'+a.key+'">'),$("form#avatar").append('<input type="hidden" name="AWSAccessKeyId" value="'+a.access_key+'">'),$("form#avatar").append('<input type="hidden" name="policy" value="'+a.policy+'">'),$("form#avatar").append('<input type="hidden" name="signature" value="'+a.signature+'">'),$("form#avatar").append('<input type="hidden" name="Content-Type" value="image/jpeg">'),$("form#avatar").append("File to upload to S3"),$("form#avatar").append('<input id="file_upload" name="file" type="file"><br>'),$("form#avatar").append('<input id="form-submit" type="submit" value="Upload File to S3">')},App.sendImageToRails=function(a){var b=$("form#avatar");$("body").on("submit",b,function(b,c){App.postImageToRails(a),$(c).submit()})},App.avatarSuccess=function(){console.log("avatar changes!"),window.location.reload(!0)},App.postImageToRails=function(a){var b=window.location.hash,c=b.lastIndexOf("/"),d=parseInt(b.substring(c+1,b.length));console.log("im inside the postimage to rails and my file name is "+a),$.ajax({url:"https://project-management-api.herokuapp.com/users"+d,type:"PATCH",data:{user:{avatar:"https://s3.amazonaws.com/project-management-bucket/"+a}}}).done(function(a){console.log(a),App.avatarSuccess(a)}).fail(function(a,b,c){console.log(a,b,c)}).always(function(a){console.log(a)})};